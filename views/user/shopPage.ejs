<!DOCTYPE HTML>
<html>
	<head>
	<title>Cosmix website</title>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Rokkitt:100,300,400,700" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Ion Icon Fonts-->
	<link rel="stylesheet" href="css/ionicons.min.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">

	<!-- Owl Carousel -->
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	
	<!-- Date Picker -->
	<link rel="stylesheet" href="css/bootstrap-datepicker.css">
	<!-- Flaticons  -->
	<link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	</head>
	<body>
		
	<div class="colorlib-loader"></div>

	<div id="page">
		<%- include("../../views/partials/user/header.ejs")%>

		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col">
						<p class="bread"><span><a href="http://localhost:4000">Home</a></span> / <span>Shop</span></p>
					</div>
				</div>
			</div>
		</div>


        <div class="colorlib-product">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 col-xl-3">
						<button > <a href="http://localhost:4000/shop">Clear Filters</a></button>
						<div class="row">
							<div class="col-sm-12">
								<div class="side border mb-1">
									<form id="filterForm">
										<label><input type="checkbox" class="category-checkbox" value="Makeup"> Makeup</label><br>
										<label><input type="checkbox" class="category-checkbox" value="Facecare"> Facecare</label><br>
										<label><input type="checkbox" class="category-checkbox" value="Bodycare"> Bodycare</label><br>
										<label><input type="checkbox" class="category-checkbox" value="Shampoo"> Shampoo</label><br>
										<label><input type="checkbox" class="category-checkbox" value="Conditioner"> Conditioner</label><br>
										<label><input type="checkbox" class="category-checkbox" value="Serum"> Serum</label><br>
										<button type="button" id="applyFilter">Apply</button>
									  </form>
								</div>
							</div>
							<div class="col-sm-12">
								<div class="side border mb-1">
									<h3>Price Range</h3>
									<div class="block-26 mb-2">
										
					               <ul>
							
										<input type="checkbox" id="below500" value="0-500">
										<label for="below500">Below 500</label><br>

										<input type="checkbox" id="500-1000" value="500-1000">
										<label for="500-1000">500 - 1000</label><br/>

										<input type="checkbox" id="1000-2000" value="1000-2000">
										<label for="1000-2000">1000 - 2000</label><br/>

										<input type="checkbox" id="above2000" value="2000-9999999">
										<label for="above2000">Above 2000</label><br/>
										<button id="applyPriceFilter">Apply Price Filter</button>

					               </ul>
					            </div>
					    
								</div>
							</div>
							
							<div class="col-sm-12">
								<div class="side border mb-1">
									<h3>Sorting</h3>
									<ul>
                                        <div class="side border mb-1">
											
											<ul>
												<h6>Price Range</h6>
												<input type="checkbox" name="priceSort" id="price-low-to-high" value="low-to-high"><label for="price-low-to-high"> Low to High</label><br/>
												<input type="checkbox" name="priceSort" id="price-high-to-low" value="high-to-low"><label for="price-high-to-low"> High to Low</label><br/>
												
												<h6>Products</h6>
												<input type="checkbox" name="productSort" id="product-a-to-z" value="a-to-z"><label for="product-a-to-z"> Aa-Zz</label><br/>
											
												<input type="checkbox" name="productSort" id="product-z-to-a" value="z-to-a"><label for="product-z-to-a"> Zz-Aa</label><br/>
											<button id="sortingbutton" onclick="window.location.reload()">Apply</button>
											</ul>
										</div>
										
									</ul>
								</div>
							</div>
							
							
						</div>
					</div>
					<div  class="col-lg-9 col-xl-9">
						<div id="productList" class="row row-pb-md">
							
							<% products.forEach(product => { %>
								<% if (product.quantity > 0 && product.isBlocked === false) { %>


							<div class="col-lg-4 mb-4 text-center">
								<div class="product-entry border">
									<a href="/productdetails/<%= product._id %>" class="prod-img">
										<% if (product.productImage && product.productImage.length > 0) { %>

										<img src="/uploads/<%= product.productImage[0] %>" class="img-fluid" alt="Free html5 bootstrap 4 template">
										<% } else { %>
											<p>No Image</p>
									<% } %>

									</a>
									<div class="desc">
										<h2><a href="/productdetails/<%= product._id %>"><%=product.productName%></a></h2>
										<span class="price"><%=product.regularPrice%></span>
									</div>
								</div>
							</div>

							<%}%>
							<%})%>
							
							
							
							
							
							
						
							
						
						
						</div>
						<div class="row">
							<div class="col-md-12 text-center">
								<div class="block-27">
				               <ul>
					               <li><a href="#"><i class="ion-ios-arrow-back"></i></a></li>
				                  <li class="active"><span>1</span></li>
				                  <li><a href="#">2</a></li>
				                  <li><a href="#">3</a></li>
				                  <li><a href="#">4</a></li>
				                  <li><a href="#">5</a></li>
				                  <li><a href="#"><i class="ion-ios-arrow-forward"></i></a></li>
				               </ul>
				            </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

					<div class="col-md-12 text-center">
						<p><a href="#" class="btn btn-primary btn-lg">Shop All Products</a></p>
					</div>
				
			
		</div>


		
        <%- include("../../views/partials/user/footer.ejs")%>

	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="ion-ios-arrow-up"></i></a>
	</div>

	<script>
		
		document.getElementById('applyFilter').addEventListener('click', function () {
  // Get all checked checkboxes
  const selectedCategories = Array.from(
    document.querySelectorAll('.category-checkbox:checked')
  ).map((checkbox) => checkbox.value.toLowerCase());

  // Check if any categories are selected
  if (selectedCategories.length === 0) {
    alert('Please select at least one category.');
    return;
  }

  // Create a URLSearchParams object to build the query string
  const params = new URLSearchParams();
  params.append('categories', selectedCategories.join(','));

  // Update the URL (e.g., navigate to `/shop/filter` with query params)
  const newUrl = `/shop/filter?${params.toString()}`;
  window.location.href = newUrl;
});


document.getElementById('applyPriceFilter').addEventListener('click', function () {
    // Collect selected price range values
    const selectedRanges = Array.from(
        document.querySelectorAll('input[type="checkbox"]:checked')
    ).map(checkbox => checkbox.value);

    if (selectedRanges.length === 0) {
        alert('Please select at least one price range.');
        return;
    }

    // Create a URLSearchParams object to build the query string
    const params = new URLSearchParams();
    
    // Pass the selected price ranges as a parameter
    params.append('priceRanges', selectedRanges.join(','));

    // Assuming categories filter is also part of the URL (you can modify based on your use case)
    const selectedCategories = Array.from(
        document.querySelectorAll('.category-checkbox:checked')
    ).map(checkbox => checkbox.value);
    
    if (selectedCategories.length > 0) {
        params.append('categories', selectedCategories.join(','));
    }

    // Update the URL with price ranges (and categories, if any)
    const newUrl = `/shop/filter?${params.toString()}`;
    window.location.href = newUrl;
});

// Function to handle sorting option changes
const handleSortChange = () => {
    const priceSort = document.querySelector('input[name="priceSort"]:checked');
    const productSort = document.querySelector('input[name="productSort"]:checked');

    // Initialize the URL parameters object
    const params = new URLSearchParams();

    // Add selected sorting options to URL parameters if available
    if (priceSort) {
        params.set('priceSort', priceSort.value); // For price sorting
    }
    if (productSort) {
        params.set('productSort', productSort.value); // For product sorting
    }

    // Build the new URL with the updated query string
    const newUrl = `/shop/filter?${params.toString()}`;
   const resultpath =  window.history.pushState({}, '', newUrl) // Update the browser URL without reloading the page
};

// Attach event listeners to all sorting options
document.querySelectorAll('input[name="priceSort"], input[name="productSort"]').forEach(input => {
    input.addEventListener('change', handleSortChange);
});


	</script>
	
	
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
   <!-- popper -->
   <script src="js/popper.min.js"></script>
   <!-- bootstrap 4.1 -->
   <script src="js/bootstrap.min.js"></script>
   <!-- jQuery easing -->
   <script src="js/jquery.easing.1.3.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	<!-- Owl carousel -->
	<script src="js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<!-- Date Picker -->
	<script src="js/bootstrap-datepicker.js"></script>
	<!-- Stellar Parallax -->
	<script src="js/jquery.stellar.min.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>

	</body>
</html>

